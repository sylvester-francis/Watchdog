{{define "dashboard.html"}}
{{template "base" .}}
{{end}}

{{define "content"}}
<!-- Stats Grid -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
    <!-- Total Monitors -->
    <div class="bg-card border border-border rounded-lg p-5">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-xs font-medium text-muted-foreground">Total Monitors</p>
                <p class="text-2xl font-semibold text-foreground mt-1">{{.Stats.TotalMonitors}}</p>
            </div>
            <div class="w-10 h-10 bg-blue-500/10 rounded-lg flex items-center justify-center">
                <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
            </div>
        </div>
    </div>

    <!-- Monitors Up -->
    <div class="bg-card border border-border rounded-lg p-5">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-xs font-medium text-muted-foreground">Up</p>
                <p class="text-2xl font-semibold text-emerald-400 mt-1">{{.Stats.MonitorsUp}}</p>
            </div>
            <div class="w-10 h-10 bg-emerald-500/10 rounded-lg flex items-center justify-center">
                <svg class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
        </div>
    </div>

    <!-- Monitors Down -->
    <div class="bg-card border border-border rounded-lg p-5">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-xs font-medium text-muted-foreground">Down</p>
                <p class="text-2xl font-semibold {{if gt .Stats.MonitorsDown 0}}text-red-400{{else}}text-foreground{{end}} mt-1">{{.Stats.MonitorsDown}}</p>
            </div>
            <div class="w-10 h-10 {{if gt .Stats.MonitorsDown 0}}bg-red-500/10{{else}}bg-muted{{end}} rounded-lg flex items-center justify-center">
                <svg class="w-5 h-5 {{if gt .Stats.MonitorsDown 0}}text-red-400{{else}}text-muted-foreground{{end}}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
        </div>
    </div>

    <!-- Active Incidents -->
    <div class="bg-card border {{if gt .Stats.ActiveIncidents 0}}border-red-500/30{{else}}border-border{{end}} rounded-lg p-5">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-xs font-medium text-muted-foreground">Active Incidents</p>
                <p class="text-2xl font-semibold {{if gt .Stats.ActiveIncidents 0}}text-red-400{{else}}text-foreground{{end}} mt-1">{{.Stats.ActiveIncidents}}</p>
            </div>
            <div class="w-10 h-10 {{if gt .Stats.ActiveIncidents 0}}bg-red-500/10{{else}}bg-muted{{end}} rounded-lg flex items-center justify-center">
                <svg class="w-5 h-5 {{if gt .Stats.ActiveIncidents 0}}text-red-400{{else}}text-muted-foreground{{end}}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                </svg>
            </div>
        </div>
    </div>
</div>

<!-- Monitor Overview -->
{{if .Monitors}}
<div class="bg-card border border-border rounded-lg mb-6">
    <div class="px-5 py-4 border-b border-border flex items-center justify-between">
        <h2 class="text-sm font-medium text-foreground">Monitors</h2>
        <a href="/monitors" class="text-xs text-muted-foreground hover:text-foreground transition-smooth">View all</a>
    </div>

    <!-- Status Bar -->
    <div class="px-5 py-4 border-b border-border">
        <div class="flex items-center space-x-4 mb-3">
            <div class="flex items-center space-x-1.5">
                <div class="w-2 h-2 rounded-full bg-emerald-400"></div>
                <span class="text-xs text-muted-foreground">{{.Stats.MonitorsUp}} up</span>
            </div>
            <div class="flex items-center space-x-1.5">
                <div class="w-2 h-2 rounded-full bg-red-400"></div>
                <span class="text-xs text-muted-foreground">{{.Stats.MonitorsDown}} down</span>
            </div>
            {{if gt (sub .Stats.TotalMonitors (add .Stats.MonitorsUp .Stats.MonitorsDown)) 0}}
            <div class="flex items-center space-x-1.5">
                <div class="w-2 h-2 rounded-full bg-zinc-500"></div>
                <span class="text-xs text-muted-foreground">{{sub .Stats.TotalMonitors (add .Stats.MonitorsUp .Stats.MonitorsDown)}} unknown</span>
            </div>
            {{end}}
        </div>
        <div class="w-full h-2 bg-muted rounded-full overflow-hidden flex">
            {{if gt .Stats.TotalMonitors 0}}
            {{if gt .Stats.MonitorsUp 0}}
            <div class="bg-emerald-400 h-full" style="width: calc({{.Stats.MonitorsUp}} / {{.Stats.TotalMonitors}} * 100%)"></div>
            {{end}}
            {{if gt .Stats.MonitorsDown 0}}
            <div class="bg-red-400 h-full" style="width: calc({{.Stats.MonitorsDown}} / {{.Stats.TotalMonitors}} * 100%)"></div>
            {{end}}
            {{end}}
        </div>
    </div>

    <!-- Monitor Grid -->
    <div class="p-5">
        <div class="flex flex-wrap gap-2">
            {{range .Monitors}}
            <a href="/monitors/{{.ID}}" class="inline-flex items-center space-x-1.5 px-2.5 py-1.5 rounded-md text-xs transition-smooth
                {{if eq (print .Status) "up"}}bg-emerald-500/10 text-emerald-400 hover:bg-emerald-500/20
                {{else if eq (print .Status) "down"}}bg-red-500/10 text-red-400 hover:bg-red-500/20
                {{else}}bg-muted text-muted-foreground hover:bg-muted/80{{end}}">
                <div class="w-1.5 h-1.5 rounded-full
                    {{if eq (print .Status) "up"}}bg-emerald-400 animate-pulse-dot
                    {{else if eq (print .Status) "down"}}bg-red-400
                    {{else}}bg-zinc-500{{end}}"></div>
                <span>{{.Name}}</span>
            </a>
            {{end}}
        </div>
    </div>
</div>
{{end}}

<!-- Two Column: Agents + Incidents -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Agents -->
    <div class="bg-card border border-border rounded-lg">
        <div class="px-5 py-4 border-b border-border">
            <h2 class="text-sm font-medium text-foreground">Agents</h2>
        </div>
        <div class="p-5" hx-ext="sse" sse-connect="/sse/events">
            {{if .Agents}}
            <div class="space-y-3" id="agents-grid">
                {{range .Agents}}
                <div id="agent-{{.ID}}" class="flex items-center justify-between p-3 rounded-md bg-muted/30 border border-border" sse-swap="agent-status:{{.ID}}">
                    <div class="flex items-center space-x-3">
                        <div class="w-2 h-2 rounded-full {{if .IsOnline}}bg-emerald-400 animate-pulse-dot{{else}}bg-zinc-500{{end}}"></div>
                        <div>
                            <p class="text-sm font-medium text-foreground">{{.Name}}</p>
                            <p class="text-xs text-muted-foreground">
                                {{if .LastSeenAt}}Last seen {{formatTimeAgo .LastSeenAt}}{{else}}Never connected{{end}}
                            </p>
                        </div>
                    </div>
                    <span class="text-xs px-2 py-0.5 rounded-md
                        {{if .IsOnline}}bg-emerald-500/15 text-emerald-400{{else}}bg-muted text-muted-foreground{{end}}">
                        {{.Status}}
                    </span>
                </div>
                {{end}}
            </div>
            {{else}}
            <div class="text-center py-8">
                <p class="text-sm text-muted-foreground">No agents deployed yet.</p>
            </div>
            {{end}}
        </div>
    </div>

    <!-- Active Incidents -->
    <div class="bg-card border border-border rounded-lg">
        <div class="px-5 py-4 border-b border-border flex items-center justify-between">
            <h2 class="text-sm font-medium text-foreground">Active Incidents</h2>
            {{if .ActiveIncidents}}
            <a href="/incidents" class="text-xs text-muted-foreground hover:text-foreground transition-smooth">View all</a>
            {{end}}
        </div>
        <div class="divide-y divide-border">
            {{if .IncidentsWithMonitors}}
            {{range .IncidentsWithMonitors}}
            <div class="px-5 py-3 flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 rounded-md {{if eq (print .Incident.Status) "open"}}bg-red-500/10{{else}}bg-yellow-500/10{{end}} flex items-center justify-center">
                        <svg class="w-4 h-4 {{if eq (print .Incident.Status) "open"}}text-red-400{{else}}text-yellow-400{{end}}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                        </svg>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-foreground">{{if .Monitor}}{{.Monitor.Name}}{{else}}Unknown Monitor{{end}}</p>
                        <p class="text-xs text-muted-foreground">{{formatTimeAgo .Incident.StartedAt}}</p>
                    </div>
                </div>
                <span class="text-xs px-2 py-0.5 rounded-md
                    {{if eq (print .Incident.Status) "open"}}bg-red-500/15 text-red-400
                    {{else}}bg-yellow-500/15 text-yellow-400{{end}}">
                    {{.Incident.Status}}
                </span>
            </div>
            {{end}}
            {{else}}
            <div class="px-5 py-8 text-center">
                <svg class="w-8 h-8 text-muted-foreground/30 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <p class="text-sm text-muted-foreground">No active incidents</p>
            </div>
            {{end}}
        </div>
    </div>
</div>
{{end}}
