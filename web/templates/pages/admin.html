{{define "admin.html"}}
{{template "base" .}}
{{end}}

{{define "content"}}
<!-- Platform Overview -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <!-- Total Users -->
    <div class="bg-gray-800 rounded-xl border border-gray-700 p-6">
        <p class="text-gray-400 text-sm">Total Users</p>
        <p class="text-3xl font-bold text-white mt-1">{{.TotalUsers}}</p>
    </div>

    <!-- Plan Breakdown -->
    <div class="bg-gray-800 rounded-xl border border-gray-700 p-6">
        <p class="text-gray-400 text-sm mb-2">Plan Breakdown</p>
        <div class="flex items-center space-x-3">
            <span class="px-2 py-1 text-xs rounded bg-gray-700 text-gray-300">Free: {{.PlanFree}}</span>
            <span class="px-2 py-1 text-xs rounded bg-blue-500/20 text-blue-400">Pro: {{.PlanPro}}</span>
            <span class="px-2 py-1 text-xs rounded bg-purple-500/20 text-purple-400">Team: {{.PlanTeam}}</span>
        </div>
    </div>

    <!-- Limit Hits (24h) -->
    <div class="bg-gray-800 rounded-xl border border-gray-700 p-6">
        <p class="text-gray-400 text-sm">Limit Hits (24h)</p>
        <p class="text-3xl font-bold {{if gt .LimitHitCount 0}}text-red-400{{else}}text-white{{end}} mt-1">{{.LimitHitCount}}</p>
    </div>

    <!-- Spacer -->
    <div class="bg-gray-800 rounded-xl border border-gray-700 p-6">
        <p class="text-gray-400 text-sm">Admin Panel</p>
        <p class="text-sm text-gray-500 mt-2">Manage users and monitor platform usage.</p>
    </div>
</div>

<!-- Upgrade Candidates -->
<div class="bg-gray-800 rounded-xl border border-gray-700 mb-8">
    <div class="px-6 py-4 border-b border-gray-700">
        <h2 class="text-lg font-semibold text-white">Upgrade Candidates</h2>
        <p class="text-sm text-gray-400">Users at 80%+ of their plan limits</p>
    </div>
    {{if .NearLimitUsers}}
    <div class="overflow-x-auto">
        <table class="w-full">
            <thead>
                <tr class="border-b border-gray-700">
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase">Email</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase">Plan</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase">Agents</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase">Monitors</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase">Status</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-700">
                {{range .NearLimitUsers}}
                <tr class="hover:bg-gray-700/50">
                    <td class="px-6 py-4 text-white">{{.Email}}</td>
                    <td class="px-6 py-4">
                        <span class="px-2 py-1 text-xs rounded
                            {{if eq .Plan.String "Pro"}}bg-blue-500/20 text-blue-400
                            {{else}}bg-gray-700 text-gray-300{{end}}">
                            {{.Plan.String}}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-gray-400">{{.AgentCount}} / {{.AgentMax}}</td>
                    <td class="px-6 py-4 text-gray-400">
                        {{.MonitorCount}} / {{if eq .MonitorMax -1}}Unlimited{{else}}{{.MonitorMax}}{{end}}
                    </td>
                    <td class="px-6 py-4">
                        {{if or (ge .AgentCount .AgentMax) (and (ne .MonitorMax -1) (ge .MonitorCount .MonitorMax))}}
                        <span class="px-2 py-1 text-xs rounded bg-red-500/20 text-red-400">At Limit</span>
                        {{else}}
                        <span class="px-2 py-1 text-xs rounded bg-yellow-500/20 text-yellow-400">Near Limit</span>
                        {{end}}
                    </td>
                </tr>
                {{end}}
            </tbody>
        </table>
    </div>
    {{else}}
    <div class="p-6 text-center text-gray-500">No users near their limits.</div>
    {{end}}
</div>

<!-- Recent Events -->
<div class="bg-gray-800 rounded-xl border border-gray-700">
    <div class="px-6 py-4 border-b border-gray-700">
        <h2 class="text-lg font-semibold text-white">Recent Usage Events</h2>
        <p class="text-sm text-gray-400">Last 50 limit-related events</p>
    </div>
    {{if .RecentEvents}}
    <div class="overflow-x-auto max-h-96 overflow-y-auto">
        <table class="w-full">
            <thead class="sticky top-0 bg-gray-800">
                <tr class="border-b border-gray-700">
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase">Time</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase">Event</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase">Resource</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase">Count / Max</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase">Plan</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-700">
                {{range .RecentEvents}}
                <tr class="hover:bg-gray-700/50">
                    <td class="px-6 py-3 text-gray-400 text-sm">{{formatTimeAgo .CreatedAt}}</td>
                    <td class="px-6 py-3">
                        {{if eq (print .EventType) "limit_hit"}}
                        <span class="px-2 py-1 text-xs rounded bg-red-500/20 text-red-400">Limit Hit</span>
                        {{else}}
                        <span class="px-2 py-1 text-xs rounded bg-yellow-500/20 text-yellow-400">Approaching</span>
                        {{end}}
                    </td>
                    <td class="px-6 py-3 text-gray-400 text-sm capitalize">{{.ResourceType}}</td>
                    <td class="px-6 py-3 text-gray-400 text-sm">{{.CurrentCount}} / {{.MaxAllowed}}</td>
                    <td class="px-6 py-3">
                        <span class="px-2 py-1 text-xs rounded
                            {{if eq .Plan.String "Pro"}}bg-blue-500/20 text-blue-400
                            {{else if eq .Plan.String "Team"}}bg-purple-500/20 text-purple-400
                            {{else}}bg-gray-700 text-gray-300{{end}}">
                            {{.Plan.String}}
                        </span>
                    </td>
                </tr>
                {{end}}
            </tbody>
        </table>
    </div>
    {{else}}
    <div class="p-6 text-center text-gray-500">No usage events yet.</div>
    {{end}}
</div>
{{end}}
