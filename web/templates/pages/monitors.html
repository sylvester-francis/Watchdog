{{define "monitors.html"}}
{{template "base" .}}
{{end}}

{{define "content"}}
{{if .ShowForm}}<div id="auto-open-modal"></div>{{end}}
<div x-data="monitorFilter">

<!-- Toolbar: filters + search + add -->
<div class="flex flex-col sm:flex-row sm:items-center justify-between gap-3 mb-4">
    <div class="flex items-center space-x-1.5 overflow-x-auto flex-nowrap">
        <button @click="setFilterAll"
            class="px-2.5 py-1 rounded-md text-xs font-medium transition-smooth shrink-0"
            :class="filterAllClass">
            All <span class="ml-1 text-muted-foreground" x-text="totalCountLabel"></span>
        </button>
        <button @click="setFilterHttp"
            class="px-2.5 py-1 rounded-md text-xs font-medium transition-smooth shrink-0"
            :class="filterHttpClass">
            HTTP <span class="ml-0.5 text-muted-foreground" x-text="httpCountLabel"></span>
        </button>
        <button @click="setFilterTcp"
            class="px-2.5 py-1 rounded-md text-xs font-medium transition-smooth shrink-0"
            :class="filterTcpClass">
            TCP <span class="ml-0.5 text-muted-foreground" x-text="tcpCountLabel"></span>
        </button>
        <button @click="setFilterPing"
            class="px-2.5 py-1 rounded-md text-xs font-medium transition-smooth shrink-0"
            :class="filterPingClass">
            Ping <span class="ml-0.5 text-muted-foreground" x-text="pingCountLabel"></span>
        </button>
        <button @click="setFilterDns"
            class="px-2.5 py-1 rounded-md text-xs font-medium transition-smooth shrink-0"
            :class="filterDnsClass">
            DNS <span class="ml-0.5 text-muted-foreground" x-text="dnsCountLabel"></span>
        </button>
        <button @click="setFilterTls"
            class="px-2.5 py-1 rounded-md text-xs font-medium transition-smooth shrink-0"
            :class="filterTlsClass">
            TLS <span class="ml-0.5 text-muted-foreground" x-text="tlsCountLabel"></span>
        </button>
        <button @click="setFilterDocker"
            class="px-2.5 py-1 rounded-md text-xs font-medium transition-smooth shrink-0"
            :class="filterDockerClass">
            Docker <span class="ml-0.5 text-muted-foreground" x-text="dockerCountLabel"></span>
        </button>
        <button @click="setFilterDatabase"
            class="px-2.5 py-1 rounded-md text-xs font-medium transition-smooth shrink-0"
            :class="filterDatabaseClass">
            Database <span class="ml-0.5 text-muted-foreground" x-text="databaseCountLabel"></span>
        </button>
        <button @click="setFilterSystem"
            class="px-2.5 py-1 rounded-md text-xs font-medium transition-smooth shrink-0"
            :class="filterSystemClass">
            System <span class="ml-0.5 text-muted-foreground" x-text="systemCountLabel"></span>
        </button>
    </div>
    <div class="flex items-center space-x-3">
        <div class="relative">
            <i data-lucide="search" class="w-3.5 h-3.5 text-muted-foreground absolute left-3 top-1/2 -translate-y-1/2"></i>
            <input type="text" x-model="search" placeholder="Filter monitors..."
                class="pl-9 pr-3 py-1.5 bg-card border border-border rounded-md text-xs text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-1 focus:ring-offset-background w-48">
        </div>
        <button onclick="window.dispatchEvent(new CustomEvent('open-monitor-modal'))"
            class="px-3 py-1.5 bg-accent text-accent-foreground hover:bg-accent/90 text-xs font-medium rounded-md transition-smooth flex items-center space-x-1.5">
            <i data-lucide="plus" class="w-3.5 h-3.5"></i>
            <span>New Monitor</span>
        </button>
    </div>
</div>

{{if .MonitorsWithHeartbeats}}

<!-- Services Table -->
{{if .ServiceMonitors}}
<div class="mb-4" id="services-section">
    <div class="flex items-center space-x-2 mb-3">
        <i data-lucide="globe" class="w-4 h-4 text-muted-foreground"></i>
        <h2 class="text-xs font-semibold text-muted-foreground uppercase tracking-wider">Services</h2>
    </div>
    <div class="bg-card border border-border rounded-lg">
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead>
                    <tr class="border-b border-border">
                        <th class="px-5 py-3 text-left text-[10px] font-medium text-muted-foreground uppercase tracking-wider">Status</th>
                        <th class="px-5 py-3 text-left text-[10px] font-medium text-muted-foreground uppercase tracking-wider">Name</th>
                        <th class="px-5 py-3 text-left text-[10px] font-medium text-muted-foreground uppercase tracking-wider hidden sm:table-cell">Type</th>
                        <th class="px-5 py-3 text-left text-[10px] font-medium text-muted-foreground uppercase tracking-wider hidden md:table-cell">Target</th>
                        <th class="px-5 py-3 text-left text-[10px] font-medium text-muted-foreground uppercase tracking-wider hidden lg:table-cell">Uptime</th>
                        <th class="px-5 py-3 text-left text-[10px] font-medium text-muted-foreground uppercase tracking-wider hidden lg:table-cell">Latency</th>
                        <th class="px-5 py-3 text-left text-[10px] font-medium text-muted-foreground uppercase tracking-wider hidden sm:table-cell">Interval</th>
                        <th class="px-5 py-3 text-left text-[10px] font-medium text-muted-foreground uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-border/50" id="monitors-table">
                    {{range .ServiceMonitors}}
                    <tr id="monitor-{{.Monitor.ID}}" class="hover:bg-card-elevated transition-smooth cursor-pointer"
                        data-type="{{.Monitor.Type}}" data-name="{{lower .Monitor.Name}}" data-target="{{lower .Monitor.Target}}"
                        onclick="if(!event.target.closest('button,a,[x-data]'))window.location.href='/monitors/{{.Monitor.ID}}'">
                        <td class="px-5 py-3">
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 rounded-full {{statusBgColor (print .Monitor.Status)}} {{if eq (print .Monitor.Status) "up"}}animate-pulse-dot{{end}}"></div>
                                <span class="text-xs font-medium {{statusColor (print .Monitor.Status)}}">{{.Monitor.Status}}</span>
                            </div>
                        </td>
                        <td class="px-5 py-3">
                            <a href="/monitors/{{.Monitor.ID}}" class="text-sm font-medium text-foreground hover:text-accent transition-smooth">{{.Monitor.Name}}</a>
                        </td>
                        <td class="px-5 py-3 hidden sm:table-cell">
                            <span class="px-2 py-0.5 text-[10px] rounded-md bg-muted text-muted-foreground uppercase font-mono">{{.Monitor.Type}}</span>
                        </td>
                        <td class="px-5 py-3 hidden md:table-cell">
                            <span class="text-xs text-muted-foreground font-mono truncate max-w-[200px] block" title="{{.Monitor.Target}}">{{.Monitor.Target}}</span>
                        </td>
                        <td class="px-5 py-3 hidden lg:table-cell">
                            {{if gt .UptimeTotal 0}}
                            <div class="w-20 h-2 bg-muted rounded-full overflow-hidden flex gap-px" title="{{.UptimeUp}} up / {{.UptimeDown}} down">
                                {{if gt .UptimeUp 0}}
                                <div class="bg-emerald-500 h-full rounded-sm" style="width: calc({{.UptimeUp}} / {{.UptimeTotal}} * 100%)"></div>
                                {{end}}
                                {{if gt .UptimeDown 0}}
                                <div class="bg-red-500 h-full rounded-sm" style="width: calc({{.UptimeDown}} / {{.UptimeTotal}} * 100%)"></div>
                                {{end}}
                            </div>
                            {{else}}
                            <span class="text-[10px] text-muted-foreground">--</span>
                            {{end}}
                        </td>
                        <td class="px-5 py-3 hidden lg:table-cell">
                            {{if .Latencies}}
                            <canvas id="mon-spark-{{.Monitor.ID}}" class="w-16 h-5"></canvas>
                            {{else}}
                            <span class="text-[10px] text-muted-foreground">--</span>
                            {{end}}
                        </td>
                        <td class="px-5 py-3 hidden sm:table-cell">
                            <span class="text-xs text-muted-foreground font-mono">{{.Monitor.IntervalSeconds}}s</span>
                        </td>
                        <td class="px-5 py-3">
                            <div class="relative" x-data="dropdown">
                                <button @click="toggle" class="p-1 text-muted-foreground hover:text-foreground transition-smooth rounded-md hover:bg-muted/50" aria-label="Actions for {{.Monitor.Name}}">
                                    <i data-lucide="more-vertical" class="w-4 h-4"></i>
                                </button>
                                <div x-show="open" @click.outside="close" x-cloak
                                    class="absolute right-0 top-full mt-1 w-40 bg-card-elevated border border-border rounded-lg shadow-lg z-10 py-1">
                                    <a href="/monitors/{{.Monitor.ID}}" class="flex items-center space-x-2 px-3 py-1.5 text-xs text-muted-foreground hover:text-foreground hover:bg-muted/50 transition-smooth">
                                        <i data-lucide="eye" class="w-3.5 h-3.5"></i>
                                        <span>View Details</span>
                                    </a>
                                    <button hx-delete="/monitors/{{.Monitor.ID}}" hx-target="#monitor-{{.Monitor.ID}}" hx-swap="outerHTML"
                                        hx-confirm="Are you sure you want to delete '{{.Monitor.Name}}'? This cannot be undone."
                                        class="w-full flex items-center space-x-2 px-3 py-1.5 text-xs text-destructive hover:bg-destructive/10 transition-smooth">
                                        <i data-lucide="trash-2" class="w-3.5 h-3.5"></i>
                                        <span>Delete</span>
                                    </button>
                                </div>
                            </div>
                        </td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
        </div>
    </div>
</div>
{{end}}

<!-- Infrastructure Table -->
{{if .InfraMonitors}}
<div class="mb-4" id="infra-section">
    <div class="flex items-center space-x-2 mb-3">
        <i data-lucide="hard-drive" class="w-4 h-4 text-muted-foreground"></i>
        <h2 class="text-xs font-semibold text-muted-foreground uppercase tracking-wider">Infrastructure</h2>
    </div>
    <div class="bg-card border border-border rounded-lg">
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead>
                    <tr class="border-b border-border">
                        <th class="px-5 py-3 text-left text-[10px] font-medium text-muted-foreground uppercase tracking-wider">Status</th>
                        <th class="px-5 py-3 text-left text-[10px] font-medium text-muted-foreground uppercase tracking-wider">Name</th>
                        <th class="px-5 py-3 text-left text-[10px] font-medium text-muted-foreground uppercase tracking-wider hidden sm:table-cell">Type</th>
                        <th class="px-5 py-3 text-left text-[10px] font-medium text-muted-foreground uppercase tracking-wider hidden md:table-cell">Target</th>
                        <th class="px-5 py-3 text-left text-[10px] font-medium text-muted-foreground uppercase tracking-wider hidden lg:table-cell">Health</th>
                        <th class="px-5 py-3 text-left text-[10px] font-medium text-muted-foreground uppercase tracking-wider hidden lg:table-cell">Details</th>
                        <th class="px-5 py-3 text-left text-[10px] font-medium text-muted-foreground uppercase tracking-wider hidden sm:table-cell">Interval</th>
                        <th class="px-5 py-3 text-left text-[10px] font-medium text-muted-foreground uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-border/50" id="infra-monitors-table">
                    {{range .InfraMonitors}}
                    <tr id="monitor-{{.Monitor.ID}}" class="hover:bg-card-elevated transition-smooth cursor-pointer"
                        data-type="{{.Monitor.Type}}" data-name="{{lower .Monitor.Name}}" data-target="{{lower .Monitor.Target}}"
                        onclick="if(!event.target.closest('button,a,[x-data]'))window.location.href='/monitors/{{.Monitor.ID}}'">
                        <td class="px-5 py-3">
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 rounded-full {{statusBgColor (print .Monitor.Status)}} {{if eq (print .Monitor.Status) "up"}}animate-pulse-dot{{end}}"></div>
                                <span class="text-xs font-medium {{statusColor (print .Monitor.Status)}}">{{.Monitor.Status}}</span>
                            </div>
                        </td>
                        <td class="px-5 py-3">
                            <a href="/monitors/{{.Monitor.ID}}" class="text-sm font-medium text-foreground hover:text-accent transition-smooth">{{.Monitor.Name}}</a>
                        </td>
                        <td class="px-5 py-3 hidden sm:table-cell">
                            <span class="px-2 py-0.5 text-[10px] rounded-md bg-muted text-muted-foreground uppercase font-mono">{{.Monitor.Type}}</span>
                        </td>
                        <td class="px-5 py-3 hidden md:table-cell">
                            <span class="text-xs text-muted-foreground font-mono truncate max-w-[200px] block" title="{{.Monitor.Target}}">{{.Monitor.Target}}</span>
                        </td>
                        <td class="px-5 py-3 hidden lg:table-cell">
                            {{if and (eq (print .Monitor.Type) "system") .MetricValue}}
                            <span class="text-xs font-mono text-foreground">{{.MetricValue}}</span>
                            {{else if gt .UptimeTotal 0}}
                            <div class="w-20 h-2 bg-muted rounded-full overflow-hidden flex gap-px" title="{{.UptimeUp}} up / {{.UptimeDown}} down">
                                {{if gt .UptimeUp 0}}
                                <div class="bg-emerald-500 h-full rounded-sm" style="width: calc({{.UptimeUp}} / {{.UptimeTotal}} * 100%)"></div>
                                {{end}}
                                {{if gt .UptimeDown 0}}
                                <div class="bg-red-500 h-full rounded-sm" style="width: calc({{.UptimeDown}} / {{.UptimeTotal}} * 100%)"></div>
                                {{end}}
                            </div>
                            {{else}}
                            <span class="text-[10px] text-muted-foreground">--</span>
                            {{end}}
                        </td>
                        <td class="px-5 py-3 hidden lg:table-cell">
                            {{if eq (print .Monitor.Type) "docker"}}
                            <span class="text-xs text-muted-foreground">container</span>
                            {{else if eq (print .Monitor.Type) "database"}}
                            <span class="text-xs text-muted-foreground">{{index .Monitor.Metadata "db_type"}}</span>
                            {{else if eq (print .Monitor.Type) "system"}}
                            <span class="text-xs text-muted-foreground font-mono">{{.Monitor.Target}}</span>
                            {{else}}
                            <span class="text-[10px] text-muted-foreground">--</span>
                            {{end}}
                        </td>
                        <td class="px-5 py-3 hidden sm:table-cell">
                            <span class="text-xs text-muted-foreground font-mono">{{.Monitor.IntervalSeconds}}s</span>
                        </td>
                        <td class="px-5 py-3">
                            <div class="relative" x-data="dropdown">
                                <button @click="toggle" class="p-1 text-muted-foreground hover:text-foreground transition-smooth rounded-md hover:bg-muted/50" aria-label="Actions for {{.Monitor.Name}}">
                                    <i data-lucide="more-vertical" class="w-4 h-4"></i>
                                </button>
                                <div x-show="open" @click.outside="close" x-cloak
                                    class="absolute right-0 top-full mt-1 w-40 bg-card-elevated border border-border rounded-lg shadow-lg z-10 py-1">
                                    <a href="/monitors/{{.Monitor.ID}}" class="flex items-center space-x-2 px-3 py-1.5 text-xs text-muted-foreground hover:text-foreground hover:bg-muted/50 transition-smooth">
                                        <i data-lucide="eye" class="w-3.5 h-3.5"></i>
                                        <span>View Details</span>
                                    </a>
                                    <button hx-delete="/monitors/{{.Monitor.ID}}" hx-target="#monitor-{{.Monitor.ID}}" hx-swap="outerHTML"
                                        hx-confirm="Are you sure you want to delete '{{.Monitor.Name}}'? This cannot be undone."
                                        class="w-full flex items-center space-x-2 px-3 py-1.5 text-xs text-destructive hover:bg-destructive/10 transition-smooth">
                                        <i data-lucide="trash-2" class="w-3.5 h-3.5"></i>
                                        <span>Delete</span>
                                    </button>
                                </div>
                            </div>
                        </td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
        </div>
    </div>
</div>
{{end}}

{{else}}
{{/* Table for monitors without heartbeat data (new or not yet checked) */}}
<div class="bg-card border border-border rounded-lg">
    <div class="overflow-x-auto {{if not .Monitors}}hidden{{end}}" id="monitors-table-container">
        <table class="w-full">
            <thead>
                <tr class="border-b border-border">
                    <th class="px-5 py-3 text-left text-[10px] font-medium text-muted-foreground uppercase tracking-wider">Status</th>
                    <th class="px-5 py-3 text-left text-[10px] font-medium text-muted-foreground uppercase tracking-wider">Name</th>
                    <th class="px-5 py-3 text-left text-[10px] font-medium text-muted-foreground uppercase tracking-wider hidden sm:table-cell">Type</th>
                    <th class="px-5 py-3 text-left text-[10px] font-medium text-muted-foreground uppercase tracking-wider hidden md:table-cell">Target</th>
                    <th class="px-5 py-3 text-left text-[10px] font-medium text-muted-foreground uppercase tracking-wider hidden sm:table-cell">Interval</th>
                    <th class="px-5 py-3 text-left text-[10px] font-medium text-muted-foreground uppercase tracking-wider">Actions</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-border/50" id="monitors-table">
                {{range .Monitors}}
                {{template "monitor_row" dict "Monitor" .}}
                {{end}}
            </tbody>
        </table>
    </div>
    {{if not .Monitors}}
    <div id="monitors-empty" class="text-center py-16">
        <i data-lucide="activity" class="w-12 h-12 text-muted-foreground/30 mx-auto mb-3"></i>
        <h3 class="text-sm font-medium text-foreground mb-1">No monitors yet</h3>
        <p class="text-sm text-muted-foreground mb-4">Create your first monitor to start tracking your services.</p>
        <button onclick="window.dispatchEvent(new CustomEvent('open-monitor-modal'))"
            class="px-3 py-2 bg-accent text-accent-foreground hover:bg-accent/90 text-sm font-medium rounded-md transition-smooth">
            Create Monitor
        </button>
    </div>
    {{end}}
</div>
{{end}}

<!-- No filter results message -->
<div x-show="showNoResults" x-cloak class="text-center py-10">
    <i data-lucide="search-x" class="w-8 h-8 text-muted-foreground/30 mx-auto mb-2"></i>
    <p class="text-sm text-muted-foreground">No monitors match your filter.</p>
    <button onclick="window.dispatchEvent(new CustomEvent('open-monitor-modal'))"
        class="mt-3 px-3 py-1.5 text-xs font-medium text-accent hover:text-accent/80 transition-colors">
        Create one
    </button>
</div>

</div>

<!-- New Monitor Modal -->
<div id="new-monitor-modal" x-data="monitorModal" @open-monitor-modal.window="open"
     x-show="show" x-cloak
     role="dialog" aria-label="Create monitor"
     class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50"
     x-transition:enter="transition ease-out duration-150" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
     x-transition:leave="transition ease-in duration-100" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0">
    <div class="bg-card border border-border rounded-xl w-full max-w-md mx-4 shadow-xl"
         x-show="show"
         x-transition:enter="transition ease-out duration-150" x-transition:enter-start="opacity-0 scale-95" x-transition:enter-end="opacity-100 scale-100"
         x-transition:leave="transition ease-in duration-100" x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-95"
         @click.outside="close">
        <div class="px-5 py-4 border-b border-border flex items-center justify-between">
            <div class="flex items-center space-x-2">
                <i data-lucide="plus-circle" class="w-4 h-4 text-accent"></i>
                <h3 class="text-sm font-medium text-foreground">New Monitor</h3>
            </div>
            <button @click="close"
                class="text-muted-foreground hover:text-foreground transition-smooth" aria-label="Close">
                <i data-lucide="x" class="w-4 h-4"></i>
            </button>
        </div>
        <form id="monitor-form" action="/monitors" method="POST" class="p-5 space-y-5"
            hx-post="/monitors" hx-target="#monitors-table" hx-swap="beforeend">
            {{if .CSRFToken}}<input type="hidden" name="_csrf" value="{{.CSRFToken}}">{{end}}

            <!-- Basics section -->
            <div class="space-y-4">
                <p class="text-[10px] font-medium text-muted-foreground uppercase tracking-wider">Basics</p>

                <div>
                    <label class="block text-xs font-medium text-muted-foreground mb-1.5">Name</label>
                    <input type="text" name="name" required
                        class="w-full px-3 py-2 bg-card-elevated border border-border rounded-md text-sm text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 focus:ring-offset-background"
                        placeholder="My Server">
                </div>

                <div>
                    <label class="block text-xs font-medium text-muted-foreground mb-1.5">Type</label>
                    <select name="type" required
                        class="w-full px-3 py-2 bg-card-elevated border border-border rounded-md text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 focus:ring-offset-background">
                        <option value="http">HTTP</option>
                        <option value="tcp">TCP</option>
                        <option value="ping">Ping</option>
                        <option value="dns">DNS</option>
                        <option value="tls">TLS Certificate</option>
                        <option value="docker">Docker</option>
                        <option value="database">Database</option>
                        <option value="system">System Metrics</option>
                    </select>
                </div>

                <div>
                    <label class="block text-xs font-medium text-muted-foreground mb-1.5">Target</label>
                    <input type="text" name="target" required id="monitor-target-input"
                        class="w-full px-3 py-2 bg-card-elevated border border-border rounded-md text-sm text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 focus:ring-offset-background"
                        placeholder="example.com or 192.168.1.1">
                    <p class="text-[10px] text-muted-foreground/60 mt-1" id="monitor-target-hint">Enter an IP address, hostname, or URL depending on the check type</p>
                </div>

                <!-- HTTP: Expected Content (optional) -->
                <div data-monitor-type-field="http" style="display:none">
                    <label class="block text-xs font-medium text-muted-foreground mb-1.5">Expected Content <span class="text-muted-foreground/40">(optional)</span></label>
                    <input type="text" name="expected_content"
                        class="w-full px-3 py-2 bg-card-elevated border border-border rounded-md text-sm text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 focus:ring-offset-background"
                        placeholder="e.g. &quot;healthy&quot; or &quot;OK&quot;">
                    <p class="text-[10px] text-muted-foreground/60 mt-1">Response body must contain this text to be considered healthy</p>
                </div>

                <!-- Database: Type + Connection String -->
                <div data-monitor-type-field="database" style="display:none">
                    <label class="block text-xs font-medium text-muted-foreground mb-1.5">Database Type</label>
                    <select name="db_type"
                        class="w-full px-3 py-2 bg-card-elevated border border-border rounded-md text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 focus:ring-offset-background">
                        <option value="postgres">PostgreSQL</option>
                        <option value="mysql">MySQL</option>
                        <option value="redis">Redis</option>
                    </select>
                </div>
                <div data-monitor-type-field="database" style="display:none">
                    <label class="block text-xs font-medium text-muted-foreground mb-1.5">Connection String <span class="text-muted-foreground/40">(optional)</span></label>
                    <input type="text" name="connection_string"
                        class="w-full px-3 py-2 bg-card-elevated border border-border rounded-md text-sm text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 focus:ring-offset-background"
                        placeholder="postgres://user:pass@host:5432/db?sslmode=disable">
                    <p class="text-[10px] text-muted-foreground/60 mt-1">Full connection string. If empty, target (host:port) is used with defaults.</p>
                </div>
                <div data-monitor-type-field="database" style="display:none">
                    <label class="block text-xs font-medium text-muted-foreground mb-1.5">Password <span class="text-muted-foreground/40">(Redis only, optional)</span></label>
                    <input type="password" name="password"
                        class="w-full px-3 py-2 bg-card-elevated border border-border rounded-md text-sm text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 focus:ring-offset-background"
                        placeholder="Redis AUTH password">
                </div>
            </div>

            <div class="border-t border-border/50"></div>

            <!-- Configuration section -->
            <div class="space-y-4">
                <p class="text-[10px] font-medium text-muted-foreground uppercase tracking-wider">Configuration</p>

                <div>
                    <label class="block text-xs font-medium text-muted-foreground mb-1.5">Agent</label>
                    <select name="agent_id" required
                        class="w-full px-3 py-2 bg-card-elevated border border-border rounded-md text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 focus:ring-offset-background">
                        <option value="">Select an agent</option>
                        {{range .Agents}}
                        <option value="{{.ID}}">{{.Name}} ({{if .IsOnline}}online{{else}}offline{{end}})</option>
                        {{end}}
                    </select>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-xs font-medium text-muted-foreground mb-1.5">Interval (sec)</label>
                        <input type="number" name="interval" value="30" min="5" max="3600"
                            class="w-full px-3 py-2 bg-card-elevated border border-border rounded-md text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 focus:ring-offset-background">
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-muted-foreground mb-1.5">Timeout (sec)</label>
                        <input type="number" name="timeout" value="10" min="1" max="60"
                            class="w-full px-3 py-2 bg-card-elevated border border-border rounded-md text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 focus:ring-offset-background">
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-medium text-muted-foreground mb-1.5">Failures before alert</label>
                    <input type="number" name="failure_threshold" value="3" min="1" max="20"
                        class="w-full px-3 py-2 bg-card-elevated border border-border rounded-md text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 focus:ring-offset-background">
                    <p class="text-[10px] text-muted-foreground/60 mt-1">Consecutive failures required before creating an incident</p>
                </div>
            </div>

            <div class="flex justify-end space-x-2 pt-2">
                <button type="button" @click="close"
                    class="px-3 py-2 text-sm text-muted-foreground hover:text-foreground transition-smooth">
                    Cancel
                </button>
                <button type="submit"
                    class="px-3 py-2 bg-accent text-accent-foreground hover:bg-accent/90 text-sm font-medium rounded-md transition-smooth">
                    Create Monitor
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Sparkline data for monitor table -->
{{if .MonitorsWithHeartbeats}}
<script type="application/json" id="monitor-sparkline-data">{{toJSON .MonitorsWithHeartbeats}}</script>
<script nonce="{{.Nonce}}">
document.addEventListener('DOMContentLoaded', function() {
    var el = document.getElementById('monitor-sparkline-data');
    if (!el) return;
    try {
        var monitors = JSON.parse(el.textContent);
        for (var i = 0; i < monitors.length; i++) {
            var m = monitors[i];
            if (m.Latencies && m.Latencies.length > 0 && m.Monitor) {
                var color = m.Monitor.Status === 'up' ? '#22c55e' : (m.Monitor.Status === 'down' ? '#ef4444' : '#a1a1aa');
                createSparkline('mon-spark-' + m.Monitor.ID, m.Latencies, color);
            }
        }
    } catch(e) {}
});
</script>
{{end}}
{{end}}

{{define "monitor_row"}}
<tr id="monitor-{{.Monitor.ID}}" class="hover:bg-card-elevated transition-smooth cursor-pointer"
    data-type="{{.Monitor.Type}}" data-name="{{lower .Monitor.Name}}" data-target="{{lower .Monitor.Target}}"
    onclick="if(!event.target.closest('button,a,[x-data]'))window.location.href='/monitors/{{.Monitor.ID}}'">
    <td class="px-5 py-3">
        <div class="flex items-center space-x-2">
            <div class="w-2 h-2 rounded-full {{statusBgColor (print .Monitor.Status)}} {{if eq (print .Monitor.Status) "up"}}animate-pulse-dot{{end}}"></div>
            <span class="text-xs font-medium {{statusColor (print .Monitor.Status)}}">{{.Monitor.Status}}</span>
        </div>
    </td>
    <td class="px-5 py-3">
        <a href="/monitors/{{.Monitor.ID}}" class="text-sm font-medium text-foreground hover:text-accent transition-smooth">{{.Monitor.Name}}</a>
    </td>
    <td class="px-5 py-3 hidden sm:table-cell">
        <span class="px-2 py-0.5 text-[10px] rounded-md bg-muted text-muted-foreground uppercase font-mono">{{.Monitor.Type}}</span>
    </td>
    <td class="px-5 py-3 hidden md:table-cell">
        <span class="text-xs text-muted-foreground font-mono truncate max-w-[200px] block" title="{{.Monitor.Target}}">{{.Monitor.Target}}</span>
    </td>
    <td class="px-5 py-3 hidden lg:table-cell">
        <span class="text-[10px] text-muted-foreground">--</span>
    </td>
    <td class="px-5 py-3 hidden lg:table-cell">
        <span class="text-[10px] text-muted-foreground">--</span>
    </td>
    <td class="px-5 py-3 hidden sm:table-cell">
        <span class="text-xs text-muted-foreground font-mono">{{.Monitor.IntervalSeconds}}s</span>
    </td>
    <td class="px-5 py-3">
        <div class="relative" x-data="dropdown">
            <button @click="toggle" class="p-1 text-muted-foreground hover:text-foreground transition-smooth rounded-md hover:bg-muted/50" aria-label="Actions for {{.Monitor.Name}}">
                <i data-lucide="more-vertical" class="w-4 h-4"></i>
            </button>
            <div x-show="open" @click.outside="close" x-cloak
                class="absolute right-0 top-full mt-1 w-40 bg-card-elevated border border-border rounded-lg shadow-lg z-10 py-1">
                <a href="/monitors/{{.Monitor.ID}}" class="flex items-center space-x-2 px-3 py-1.5 text-xs text-muted-foreground hover:text-foreground hover:bg-muted/50 transition-smooth">
                    <i data-lucide="eye" class="w-3.5 h-3.5"></i>
                    <span>View Details</span>
                </a>
                <button hx-delete="/monitors/{{.Monitor.ID}}" hx-target="#monitor-{{.Monitor.ID}}" hx-swap="outerHTML"
                    hx-confirm="Are you sure you want to delete '{{.Monitor.Name}}'? This cannot be undone."
                    class="w-full flex items-center space-x-2 px-3 py-1.5 text-xs text-destructive hover:bg-destructive/10 transition-smooth">
                    <i data-lucide="trash-2" class="w-3.5 h-3.5"></i>
                    <span>Delete</span>
                </button>
            </div>
        </div>
    </td>
</tr>
{{end}}
