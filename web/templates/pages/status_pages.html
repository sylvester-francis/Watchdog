{{define "status_pages.html"}}
{{template "base" .}}
{{end}}

{{define "content"}}
<div class="space-y-4">
    <!-- Header -->
    <div class="flex items-center justify-between">
        <div></div>
        <button @click="$dispatch('open-page-modal')"
                class="px-3 py-1.5 bg-accent text-accent-foreground text-xs font-medium rounded-md hover:bg-accent/90 transition-colors">
            New Status Page
        </button>
    </div>

    {{if .Error}}
    <div class="bg-destructive/10 border border-destructive/20 text-destructive text-sm px-4 py-3 rounded-lg">
        {{.Error}}
    </div>
    {{end}}

    <!-- Status Pages List -->
    <div class="bg-card border border-border rounded-lg">
        {{if .StatusPages}}
        <div class="divide-y divide-border">
            {{range .StatusPages}}
            <div class="px-4 py-3 flex flex-col sm:flex-row sm:items-center justify-between gap-2">
                <div class="flex-1 min-w-0">
                    <div class="flex items-center space-x-2">
                        <span class="text-sm font-medium text-foreground">{{.Name}}</span>
                        {{if .IsPublic}}
                        <span class="text-[10px] px-1.5 py-0.5 rounded bg-green-500/15 text-green-400 font-medium">Public</span>
                        {{else}}
                        <span class="text-[10px] px-1.5 py-0.5 rounded bg-muted text-muted-foreground font-medium">Private</span>
                        {{end}}
                    </div>
                    <div class="text-xs text-muted-foreground mt-0.5 truncate">
                        <span class="font-mono">/status/@{{$.Username}}/{{.Slug}}</span>
                        {{if .Description}} &mdash; {{.Description}}{{end}}
                    </div>
                </div>
                <div class="flex items-center flex-wrap gap-1 shrink-0">
                    <a href="/status/@{{$.Username}}/{{.Slug}}" target="_blank"
                       class="px-2 py-1 text-xs text-muted-foreground hover:text-foreground transition-colors">
                        View
                    </a>
                    <a href="/status-pages/{{.ID}}/edit"
                       class="px-2 py-1 text-xs text-muted-foreground hover:text-foreground transition-colors">
                        Edit
                    </a>
                    <button class="px-2 py-1 text-xs text-destructive hover:text-destructive/80 transition-colors js-delete-page"
                            data-page-id="{{.ID}}" data-page-name="{{.Name}}"
                            aria-label="Delete status page {{.Name}}">
                        Delete
                    </button>
                </div>
            </div>
            {{end}}
        </div>
        {{else}}
        <div class="px-4 py-8 text-center">
            <i data-lucide="globe" class="w-8 h-8 text-muted-foreground/30 mx-auto mb-2"></i>
            <p class="text-sm text-muted-foreground">No status pages yet.</p>
            <p class="text-xs text-muted-foreground/70 mt-1">Create one to share your infrastructure health publicly.</p>
        </div>
        {{end}}
    </div>
</div>

<!-- New Status Page Modal -->
<div id="new-page-modal" x-data="statusPageModal" @open-page-modal.window="open"
     x-show="show" x-cloak
     role="dialog" aria-label="New status page"
     class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center"
     x-transition:enter="transition ease-out duration-150" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
     x-transition:leave="transition ease-in duration-100" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0">
    <div class="bg-card border border-border rounded-lg shadow-lg w-full max-w-md mx-4 modal-enter"
         @click.outside="close">
        <div class="px-4 py-3 border-b border-border flex items-center justify-between">
            <h3 class="text-sm font-medium text-foreground">New Status Page</h3>
            <button @click="close"
                    class="text-muted-foreground hover:text-foreground" aria-label="Close">
                <i data-lucide="x" class="w-4 h-4"></i>
            </button>
        </div>
        <form method="POST" action="/status-pages" class="p-4 space-y-3">
            <input type="hidden" name="_csrf" value="{{.CSRFToken}}">
            <div>
                <label class="block text-xs font-medium text-muted-foreground mb-1">Name</label>
                <input type="text" name="name" required
                       class="w-full px-3 py-1.5 bg-background border border-border rounded-md text-sm text-foreground placeholder-muted-foreground focus:outline-none focus:ring-1 focus:ring-accent"
                       placeholder="My Status Page">
            </div>
            <div>
                <label class="block text-xs font-medium text-muted-foreground mb-1">Description (optional)</label>
                <input type="text" name="description"
                       class="w-full px-3 py-1.5 bg-background border border-border rounded-md text-sm text-foreground placeholder-muted-foreground focus:outline-none focus:ring-1 focus:ring-accent"
                       placeholder="Current system status">
            </div>
            <div class="flex justify-end space-x-2 pt-2">
                <button type="button" @click="close"
                        class="px-3 py-1.5 text-xs text-muted-foreground hover:text-foreground transition-colors">
                    Cancel
                </button>
                <button type="submit"
                        class="px-3 py-1.5 bg-accent text-accent-foreground text-xs font-medium rounded-md hover:bg-accent/90 transition-colors">
                    Create
                </button>
            </div>
        </form>
    </div>
</div>

<script nonce="{{.Nonce}}">
document.addEventListener('click', function(e) {
    var btn = e.target.closest('.js-delete-page');
    if (!btn) return;
    var id = btn.getAttribute('data-page-id');
    var name = btn.getAttribute('data-page-name');
    if (!confirm("Are you sure you want to delete '" + name + "'? This action cannot be undone.")) return;
    var token = document.querySelector('meta[name="csrf-token"]');
    fetch('/status-pages/' + id, {
        method: 'DELETE',
        headers: token ? {'X-CSRF-Token': token.content} : {}
    }).then(function() { window.location.reload(); });
});
</script>
{{end}}
