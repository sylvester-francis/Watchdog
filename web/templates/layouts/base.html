{{define "base"}}
<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{if .Title}}{{.Title}} - {{end}}WatchDog</title>
    <link rel="icon" href="/static/favicon.svg" type="image/svg+xml">

    <!-- Fonts: Inter + JetBrains Mono -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <!-- CSRF token for HTMX requests -->
    {{if .CSRFToken}}<meta name="csrf-token" content="{{.CSRFToken}}">{{end}}

    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10/dist/ext/sse.js"></script>

    <!-- Alpine.js Components (registers via alpine:init, must load before Alpine) -->
    <script src="/static/js/alpine-components.js?v=9"></script>

    <!-- Alpine.js (CSP build â€” no unsafe-eval needed) -->
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/csp@3.14.8/dist/cdn.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@0.469.0/dist/umd/lucide.min.js"></script>

    <!-- Tailwind CSS (pre-built) -->
    <link rel="stylesheet" href="/static/css/output.css">
</head>
<body class="bg-background text-foreground font-sans min-h-screen antialiased"
      x-data="baseLayout"
      @keydown.meta.k.prevent="toggleCommandPalette"
      @keydown.ctrl.k.prevent="toggleCommandPalette">
    <!-- HTMX loading progress bar -->
    <div id="htmx-progress"></div>

    <div class="flex min-h-screen">
        <!-- Sidebar -->
        {{template "sidebar" .}}

        <!-- Main content -->
        <main class="flex-1 lg:ml-64 flex flex-col min-h-screen">
            <!-- Top bar -->
            <header class="sticky top-0 z-40 bg-background/80 backdrop-blur-sm border-b border-border px-6 h-14 flex items-center">
                <div class="flex items-center justify-between w-full">
                    <div class="flex items-center space-x-3">
                        <!-- Mobile hamburger -->
                        <button @click="toggleSidebar"
                                aria-label="Toggle navigation menu"
                                class="lg:hidden p-1.5 rounded-md text-muted-foreground hover:text-foreground hover:bg-muted/50 transition-smooth">
                            <i data-lucide="menu" class="w-5 h-5"></i>
                        </button>
                        <h1 class="text-base font-semibold text-foreground">{{.Title}}</h1>
                        <div id="sse-live-indicator" class="hidden flex items-center space-x-1 ml-2">
                            <span class="w-1.5 h-1.5 rounded-full bg-emerald-400 animate-pulse-dot"></span>
                            <span class="text-[10px] text-emerald-400/70 font-medium">Live</span>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <!-- Cmd+K trigger -->
                        <button @click="openCommandPalette"
                                class="hidden sm:flex items-center space-x-2 px-3 py-1.5 rounded-md border border-border bg-card text-muted-foreground text-xs hover:text-foreground hover:border-muted-foreground/30 transition-smooth">
                            <i data-lucide="search" class="w-3.5 h-3.5"></i>
                            <span>Search...</span>
                            <kbd class="ml-2 px-1.5 py-0.5 rounded bg-muted text-[10px] font-mono">&#8984;K</kbd>
                        </button>
                        <form action="/logout" method="POST" class="inline">
                            {{if .CSRFToken}}<input type="hidden" name="_csrf" value="{{.CSRFToken}}">{{end}}
                            <button type="submit" class="text-xs text-muted-foreground hover:text-foreground transition-smooth">
                                Logout
                            </button>
                        </form>
                    </div>
                </div>
            </header>

            <!-- Page content -->
            <div class="p-6 flex-1">
                {{if .Error}}
                <div class="bg-destructive/10 border border-destructive/20 text-destructive px-4 py-3 rounded-lg mb-6 text-sm">
                    {{.Error}}
                </div>
                {{end}}

                {{if .Success}}
                <div class="bg-emerald-500/10 border border-emerald-500/20 text-emerald-400 px-4 py-3 rounded-lg mb-6 text-sm">
                    {{.Success}}
                </div>
                {{end}}

                {{template "content" .}}
            </div>

            <!-- Footer -->
            <footer class="mt-auto px-6 h-12 flex items-center border-t border-border/50">
                <div class="flex flex-col sm:flex-row items-center justify-between gap-1 w-full">
                    <p class="text-[11px] text-muted-foreground/50">Open source &middot; Self-hosted &middot; Zero-trust</p>
                    <div class="flex items-center space-x-3">
                        <a href="https://github.com/sylvester-francis/Watchdog" target="_blank" rel="noopener noreferrer" class="text-[11px] text-muted-foreground/50 hover:text-muted-foreground transition-colors">GitHub</a>
                        <a href="https://discord.gg/PPPjZDVS" target="_blank" rel="noopener noreferrer" class="text-[11px] text-muted-foreground/50 hover:text-muted-foreground transition-colors">Discord</a>
                        <a href="/docs" class="text-[11px] text-muted-foreground/50 hover:text-muted-foreground transition-colors">Docs</a>
                    </div>
                </div>
            </footer>
        </main>
    </div>

    <!-- Command Palette -->
    {{template "command_palette" .}}

    <!-- Toast container -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 flex flex-col space-y-2"></div>

    <!-- Custom JS -->
    <script src="/static/js/app.js"></script>
    <script src="/static/js/charts.js"></script>
</body>
</html>
{{end}}
