{{define "command_palette"}}
<div x-show="commandPaletteOpen"
     x-cloak
     class="fixed inset-0 z-[100]"
     role="dialog"
     aria-label="Command palette"
     @keydown.escape.window="closeCommandPalette">

    <!-- Backdrop -->
    <div x-show="commandPaletteOpen"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-150"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 bg-black/60 backdrop-blur-sm"
         @click="closeCommandPalette">
    </div>

    <!-- Palette -->
    <div x-show="commandPaletteOpen"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0 scale-95"
         x-transition:enter-end="opacity-100 scale-100"
         x-transition:leave="transition ease-in duration-150"
         x-transition:leave-start="opacity-100 scale-100"
         x-transition:leave-end="opacity-0 scale-95"
         class="fixed top-[20%] left-1/2 -translate-x-1/2 w-full max-w-lg"
         x-data="commandPalette">

        <div class="bg-card border border-border rounded-xl shadow-2xl overflow-hidden">
            <!-- Search input -->
            <div class="flex items-center px-4 border-b border-border">
                <i data-lucide="search" class="w-4 h-4 text-muted-foreground shrink-0"></i>
                <input x-ref="searchInput"
                       x-model="query"
                       @input="search()"
                       @keydown="onKeydown"
                       type="text"
                       placeholder="Search pages and monitors..."
                       class="w-full bg-transparent px-3 py-3 text-sm text-foreground placeholder:text-muted-foreground focus:outline-none">
                <kbd class="shrink-0 px-1.5 py-0.5 rounded bg-muted text-muted-foreground text-[10px] font-mono">ESC</kbd>
            </div>

            <!-- Results -->
            <div class="max-h-72 overflow-y-auto p-2">
                <template x-if="noResults">
                    <div class="px-3 py-8 text-center text-sm text-muted-foreground">
                        No results found
                    </div>
                </template>

                <template x-for="(item, index) in results" :key="item.id">
                    <a :href="item.url"
                       data-cp-item
                       class="flex items-center space-x-3 px-3 py-2.5 rounded-lg text-sm transition-smooth cursor-pointer text-muted-foreground hover:bg-muted/50 hover:text-foreground"
                       @mouseenter="selectItem">
                        <i :data-lucide="item.icon" class="w-4 h-4 shrink-0"></i>
                        <span x-text="item.label" class="flex-1 truncate"></span>
                        <span x-text="item.type"
                              class="shrink-0 text-[10px] uppercase tracking-wider px-1.5 py-0.5 rounded bg-muted text-muted-foreground font-medium"></span>
                    </a>
                </template>
            </div>

            <!-- Footer -->
            <div class="px-4 py-2 border-t border-border flex items-center space-x-4 text-[10px] text-muted-foreground">
                <span class="flex items-center space-x-1">
                    <kbd class="px-1 py-0.5 rounded bg-muted font-mono">&uarr;&darr;</kbd>
                    <span>Navigate</span>
                </span>
                <span class="flex items-center space-x-1">
                    <kbd class="px-1 py-0.5 rounded bg-muted font-mono">&crarr;</kbd>
                    <span>Open</span>
                </span>
                <span class="flex items-center space-x-1">
                    <kbd class="px-1 py-0.5 rounded bg-muted font-mono">ESC</kbd>
                    <span>Close</span>
                </span>
            </div>
        </div>
    </div>
</div>

<!-- Server-injected monitor data for command palette search -->
{{if .Monitors}}
<script type="application/json" id="monitor-data">{{toJSON .Monitors}}</script>
{{end}}
{{end}}
